<html>
    <head>
        <script>
            // We need to tell the router to land this IP address.
            //
            // We can't just make a request to starlinkrouter/, because it will be 
            // blocked by CORS. starlinkrouter/ is not HTTPS, and cannot be HTTPS
            // because the site is hosted on the router.
            //
            // Instead, we redirect to http://starlinkrotuer/landed, which will
            // immediately land the requesting IP address and redirect back to
            // this page with the added query parameter "landed=y".
            function land() {
                window.location.href = "http://starlinkrouter/landed";
            }

            // iOS and Android have different landing page behaviors:
            // - iOS: keeps the landing page open until the user clicks "Done" or "Cancel"
            // - Android: closes the landing page as soon as connectivity is detected
            //
            // Our target UX is to keep the landing page open for both clients until
            // the user clicks a button to connect. On iOS this is native via "Done".
            // On Android, the website must implement this button itself!
            //
            // autoland() will automatically land if the client is iOS. 
            function autoland() {
                // The user agent loads pretty quickly, but not right away. Use a timeout
                // loop instead of window.onload() since window.onload() may take a while
                // for larger websites.
                setTimeout(function() {
                    if (navigator == null) {
                        autoland();
                        return;
                    }

                    var userAgent = navigator.userAgent || navigator.veng;
                    if (userAgent == null) {
                        autoland();
                        return;
                    }

                    if (/AppleWebKit/i.test(userAgent)) {
                        land();
                        return;
                    }

                    document.getElementById("connect-button").style.visibility = "visible";
                }, 500); 
            }

            if (window.location.search.includes("landed=y")) {
                window.onload = function() {
                    document.getElementById("landed").style.visibility = "visible";
                };
            } else {
                autoland();
            }
            // Dummy code to show whether the user is currently landed.
            window.onload()
        </script>
    </head>
    <body>
        <h1>My Landing Page</h1>
        </br>
        </br>
        <div>
            Landing page? more like takeoff page.
            <button id="connect-button" style="visibility: none;" onclick="land()">Connect</button>
            <div id="landed" style="visibility: none;">Landed! Cruising altitude.</div>
        </div>
    </body>
</html>